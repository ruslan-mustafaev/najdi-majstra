# Миграция: Редактирование отзывов в течение 24 часов

## Описание
Эта миграция обновляет политики безопасности для таблицы `master_reviews`, чтобы клиенты могли редактировать или удалять свои отзывы только в течение 24 часов после публикации.

## Файл миграции
`supabase/migrations/20251021000000_update_review_edit_policies.sql`

## Применение миграции

### Через Supabase Dashboard

1. Откройте [Supabase Dashboard](https://app.supabase.com)
2. Выберите ваш проект
3. Перейдите в раздел **SQL Editor**
4. Откройте файл миграции и скопируйте весь SQL код
5. Вставьте код в редактор и нажмите **Run**

### Альтернативный способ

Если у вас есть доступ к MCP инструменту `mcp__supabase__apply_migration`, используйте его для автоматического применения миграции.

## Что изменилось

### Обновленные политики RLS

1. **UPDATE policy**: Клиенты могут редактировать свои отзывы только в течение 24 часов
2. **DELETE policy**: Клиенты могут удалять свои отзывы только в течение 24 часов

### Функционал на фронтенде

- Кнопки "Редактировать" и "Удалить" отображаются только для собственных отзывов
- Кнопки видны только в течение 24 часов после публикации
- При редактировании можно изменить как комментарий, так и рейтинг
- Показывается информация о времени, до которого доступно редактирование

## Проверка

После применения миграции:

1. Войдите как клиент (не мастер)
2. Оставьте отзыв на профиле любого мастера
3. Убедитесь, что кнопки "Редактировать" и "Удалить" появились рядом с отзывом
4. Попробуйте отредактировать отзыв - должно работать
5. Проверьте, что отображается информация о сроке редактирования

## Примечания

- Политики применяются на уровне базы данных, поэтому даже прямые SQL запросы не смогут обойти ограничение
- Поле `updated_at` автоматически обновляется при редактировании отзыва
- Старые отзывы (более 24 часов) не могут быть отредактированы или удалены
