# Отчет о возможностях загрузки файлов для мастеров

## Дата составления: 2 октября 2025

---

## 1. Общие возможности загрузки

### 1.1 Типы файлов
Система поддерживает три типа медиа-контента:
- **Аватар (profile photo)** - фотография профиля мастера
- **Фотографии работ (work images)** - портфолио выполненных работ
- **Видео работ (work videos)** - видеопрезентации выполненных проектов

---

## 2. Детальные ограничения по типам файлов

### 2.1 Аватар (Фото профиля)

| Параметр | Значение |
|----------|----------|
| **Максимальное количество** | 1 файл |
| **Максимальный размер файла** | 5 MB |
| **Разрешенные форматы** | JPEG (.jpeg, .jpg), PNG (.png), WebP (.webp) |
| **Сжатие** | ❌ НЕТ (файл загружается в оригинальном виде) |

**Примечание**: При загрузке новой аватарки старая может быть удалена, но функция удаления временно отключена в коде.

---

### 2.2 Фотографии работ (Портфолио)

| Параметр | Значение |
|----------|----------|
| **Максимальное количество** | 10 файлов |
| **Максимальный размер файла** | 10 MB каждый |
| **Максимальный общий объем** | 100 MB (10 файлов × 10 MB) |
| **Разрешенные форматы** | JPEG (.jpeg, .jpg), PNG (.png), WebP (.webp) |
| **Сжатие** | ❌ НЕТ (файлы загружаются в оригинальном виде) |

**Возможности**:
- ✅ Загрузка нескольких файлов одновременно
- ✅ Удаление отдельных файлов
- ✅ Просмотр всех загруженных файлов в панели мастера

---

### 2.3 Видео работ (Видеопортфолио)

| Параметр | Значение |
|----------|----------|
| **Максимальное количество** | 5 файлов |
| **Максимальный размер файла** | 100 MB каждый |
| **Максимальный общий объем** | 500 MB (5 файлов × 100 MB) |
| **Разрешенные форматы** | MP4 (.mp4), WebM (.webm), OGG (.ogg), AVI (.avi), MOV (.mov) |
| **Сжатие** | ❌ НЕТ (файлы загружаются в оригинальном виде) |

**Возможности**:
- ✅ Загрузка нескольких видео одновременно
- ✅ Удаление отдельных видео
- ✅ Просмотр всех загруженных видео в панели мастера

---

## 3. Итоговые возможности мастера

### 3.1 Максимальные возможности загрузки

| Тип контента | Количество файлов | Макс. размер одного файла | Макс. общий объем |
|--------------|-------------------|---------------------------|-------------------|
| Аватар | 1 | 5 MB | 5 MB |
| Фото работ | 10 | 10 MB | 100 MB |
| Видео работ | 5 | 100 MB | 500 MB |
| **ИТОГО** | **16 файлов** | - | **605 MB** |

### 3.2 Общий максимальный объем
**605 MB** на одного мастера (при полной загрузке всех доступных слотов)

---

## 4. Сжатие файлов и оптимизация хранилища

### 4.1 Текущее состояние
❌ **Сжатие НЕ применяется**

Все файлы хранятся в оригинальном виде без какой-либо обработки:
- Изображения не оптимизируются
- Видео не конвертируются
- Метаданные не удаляются
- Разрешение не уменьшается

### 4.2 Последствия отсутствия сжатия

**Плюсы**:
- ✅ Максимальное качество изображений и видео
- ✅ Отсутствие потери деталей
- ✅ Быстрая загрузка (нет времени на обработку)

**Минусы**:
- ❌ Высокое потребление дискового пространства
- ❌ Медленная загрузка страниц для пользователей с медленным интернетом
- ❌ Повышенные расходы на хранение данных на сервере
- ❌ Медленная загрузка галерей с множеством изображений

### 4.3 Рекомендации по оптимизации

#### Для изображений:
1. **Автоматическое сжатие JPEG**: качество 80-85%
2. **Конвертация в WebP**: экономия до 30-50% места
3. **Генерация thumbnails**: уменьшенные версии для превью
4. **Ограничение разрешения**: максимум 2000×2000 пикселей
5. **Удаление EXIF метаданных**: экономия нескольких KB на файл

**Потенциальная экономия**: 40-60% дискового пространства

#### Для видео:
1. **Конвертация в H.264/H.265**: стандартное сжатие видео
2. **Ограничение разрешения**: максимум 1080p
3. **Ограничение битрейта**: 2-5 Mbps для хорошего качества
4. **Генерация preview-кадров**: для быстрого просмотра

**Потенциальная экономия**: 50-70% дискового пространства

---

## 5. Хранилище Supabase

### 5.1 Структура хранения
```
supabase/storage/profile-images/
├── {user_id}/
│   ├── {timestamp}_{random}.jpg    # Аватар
│   ├── {timestamp}_{random}.jpg    # Фото работы 1
│   ├── {timestamp}_{random}.jpg    # Фото работы 2
│   ├── ...                         # До 10 фото
│   ├── {timestamp}_{random}.mp4    # Видео 1
│   ├── {timestamp}_{random}.mp4    # Видео 2
│   └── ...                         # До 5 видео
```

### 5.2 Безопасность (RLS)
Файлы защищены Row Level Security:
- ✅ Пользователь может загружать файлы только в свою папку
- ✅ Пользователь может просматривать только свои файлы
- ✅ Пользователь может удалять только свои файлы
- ✅ Публичный доступ для просмотра (для отображения в профиле)

### 5.3 Bucket настройки
- **Имя bucket**: `profile-images`
- **Публичный доступ**: ✅ Включен (для просмотра портфолио)
- **Лимит размера**: настраивается через политики
- **CORS**: настроен для загрузки с фронтенда

---

## 6. Валидация и обработка ошибок

### 6.1 Проверки перед загрузкой
- ✅ Проверка типа файла (MIME type)
- ✅ Проверка размера файла
- ✅ Проверка количества файлов
- ✅ Проверка аутентификации пользователя

### 6.2 Сообщения об ошибках
Пользователю отображаются понятные сообщения на словацком языке:
- "Súbor je príliš veľký" - файл слишком большой
- "Nepodporovaný typ súboru" - неподдерживаемый тип файла
- "Môžete nahrať maximálne X súborov" - можно загрузить максимум X файлов

---

## 7. Рекомендации по улучшению системы

### 7.1 Критичные улучшения (высокий приоритет)

1. **Внедрить сжатие изображений**
   - Автоматическое сжатие JPEG (quality: 85%)
   - Конвертация в WebP формат
   - Генерация thumbnails (200×200px для превью)
   - **Экономия**: ~50% дискового пространства

2. **Оптимизировать видео**
   - Конвертация в H.264
   - Ограничение разрешения до 1080p
   - Битрейт 3-5 Mbps
   - **Экономия**: ~60% дискового пространства

3. **Добавить прогресс-бар загрузки**
   - Особенно важно для больших видео файлов
   - Улучшит пользовательский опыт

### 7.2 Второстепенные улучшения

4. **Lazy loading для галерей**
   - Загружать изображения по мере прокрутки
   - Уменьшит первоначальное время загрузки страницы

5. **CDN интеграция**
   - Использовать CDN для быстрой доставки медиа
   - Особенно важно для международных пользователей

6. **Водяные знаки**
   - Автоматическое добавление водяных знаков на фото
   - Защита авторских прав мастеров

7. **Аналитика использования**
   - Отслеживать, какие файлы наиболее просматриваются
   - Оптимизировать хранение неиспользуемых файлов

---

## 8. Стоимость хранения (оценка)

### 8.1 При 1000 мастеров

**Без сжатия**:
- Средний объем на мастера: ~300 MB (50% заполнения)
- Общий объем: 300 GB
- Стоимость Supabase (ориентировочно): $15-25/месяц (зависит от плана)

**С сжатием (50% экономии)**:
- Средний объем на мастера: ~150 MB
- Общий объем: 150 GB
- Стоимость Supabase (ориентировочно): $8-15/месяц
- **Экономия**: ~$100-120/год

### 8.2 При 10,000 мастеров

**Без сжатия**:
- Общий объем: 3 TB
- Стоимость: $150-250/месяц

**С сжатием**:
- Общий объем: 1.5 TB
- Стоимость: $75-125/месяц
- **Экономия**: ~$900-1500/год

---

## 9. Технические детали реализации

### 9.1 Используемые технологии
- **Storage**: Supabase Storage (основан на PostgreSQL)
- **Библиотека**: @supabase/supabase-js (v2.56.1)
- **Аутентификация**: Supabase Auth
- **Безопасность**: Row Level Security (RLS)

### 9.2 Файлы системы
- `/src/lib/fileUpload.ts` - основная логика загрузки
- `/src/components/FileUpload/FileUploadManager.tsx` - UI компонент управления
- `/src/components/FileUpload/FileUploadArea.tsx` - drag & drop область

### 9.3 База данных
Ссылки на файлы хранятся в таблице `masters`:
- `profile_image_url` (text) - URL аватара
- `work_images_urls` (text[]) - массив URL фотографий работ
- `work_video_url` (text[]) - массив URL видео работ

---

## 10. Заключение

### 10.1 Текущие возможности
✅ Система позволяет мастерам загружать достаточное количество медиа-контента для презентации своих услуг:
- 1 профильное фото
- 10 фотографий работ
- 5 видео работ
- Общий объем до 605 MB

### 10.2 Основные проблемы
❌ Отсутствие сжатия файлов приводит к:
- Избыточному использованию дискового пространства
- Медленной загрузке страниц
- Повышенным расходам на хостинг

### 10.3 Приоритетная рекомендация
🎯 **КРИТИЧНО**: Внедрить автоматическое сжатие изображений и видео для экономии 50-60% дискового пространства и улучшения производительности системы.

Это можно реализовать через:
1. Edge Functions в Supabase для обработки файлов при загрузке
2. Сторонние сервисы типа Cloudinary или ImageKit
3. Клиентское сжатие перед загрузкой (browser-image-compression)

---

**Подготовил**: AI Assistant
**Дата**: 2 октября 2025
**Версия**: 1.0
