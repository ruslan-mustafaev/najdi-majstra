# üîí –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –ø–æ –Ω–∞—Å—Ç—Ä–æ–π–∫–µ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏

## ‚úÖ –ß–¢–û –ë–´–õ–û –°–î–ï–õ–ê–ù–û

### 1. –°–æ–∑–¥–∞–Ω–∞ Edge Function `openrouter-chat`
- ‚úÖ OpenRouter API –∫–ª—é—á —Ç–µ–ø–µ—Ä—å **–ù–ï –í–ò–î–ï–ù** –≤ –±—Ä–∞—É–∑–µ—Ä–µ
- ‚úÖ –í—Å–µ –∑–∞–ø—Ä–æ—Å—ã –∏–¥—É—Ç —á–µ—Ä–µ–∑ –∑–∞—â–∏—â—ë–Ω–Ω—ã–π proxy –≤ Supabase
- ‚úÖ –¢—Ä–µ–±—É–µ—Ç—Å—è –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (`verifyJWT: true`)

### 2. –£–¥–∞–ª–µ–Ω—ã —Å–µ–∫—Ä–µ—Ç–Ω—ã–µ –∫–ª—é—á–∏ –∏–∑ frontend
- ‚úÖ `STRIPE_SECRET_KEY` —É–¥–∞–ª—ë–Ω –∏–∑ `.env` –∏ `.env.example`
- ‚úÖ `VITE_OPENROUTER_API_KEY` —É–¥–∞–ª—ë–Ω –∏–∑ `.env` –∏ `.env.example`
- ‚úÖ `.env.example` —Ç–µ–ø–µ—Ä—å —Å–æ–¥–µ—Ä–∂–∏—Ç —Ç–æ–ª—å–∫–æ –ø–ª–µ–π—Å—Ö–æ–ª–¥–µ—Ä—ã

### 3. –û–±–Ω–æ–≤–ª—ë–Ω –∫–æ–¥
- ‚úÖ `src/lib/openRouterApi.ts` - —Ç–µ–ø–µ—Ä—å –∏—Å–ø–æ–ª—å–∑—É–µ—Ç Edge Function
- ‚úÖ –ü—Ä–æ–µ–∫—Ç —Å–æ–±–∏—Ä–∞–µ—Ç—Å—è –±–µ–∑ –æ—à–∏–±–æ–∫
- ‚úÖ –ù–∏–∫–∞–∫–∏–µ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ —Ñ—É–Ω–∫—Ü–∏–∏ –Ω–µ —Å–ª–æ–º–∞–Ω—ã

---

## üîß –í–ê–ñ–ù–û: –ù–ê–°–¢–†–û–ô–ö–ê ENVIRONMENT VARIABLES

### –í Supabase Dashboard

–ù—É–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å **–û–î–ò–ù** environment variable –¥–ª—è Edge Function:

1. –ü–µ—Ä–µ–π–¥–∏—Ç–µ –≤ **Supabase Dashboard** ‚Üí **Edge Functions** ‚Üí **Settings/Secrets**
2. –î–æ–±–∞–≤—å—Ç–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é:
   - **Key:** `OPENROUTER_API_KEY`
   - **Value:** `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`

**–ü—Ä–∏–º–µ—á–∞–Ω–∏–µ:** `STRIPE_SECRET_KEY` —É–∂–µ –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –Ω–∞—Å—Ç—Ä–æ–µ–Ω –≤ Supabase –¥–ª—è —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö Edge Functions (`stripe-checkout`, `stripe-webhook`).

---

### –í Netlify Environment Variables

–í Netlify —É–∂–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω—ã —Å–ª–µ–¥—É—é—â–∏–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ (–ø—Ä–æ–≤–µ—Ä—å—Ç–µ —á—Ç–æ –æ–Ω–∏ –µ—Å—Ç—å):

```
VITE_SUPABASE_URL=https://budlyqnloyiyexsocpbb.supabase.co
VITE_SUPABASE_ANON_KEY=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...
VITE_STRIPE_PUBLISHABLE_KEY=pk_test_51SKdx5FUTMN3g7t4ql9sDE46...
```

**–ù–ï –î–û–ë–ê–í–õ–Ø–ô–¢–ï** –≤ Netlify:
- ‚ùå `STRIPE_SECRET_KEY` (–∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –≤ Edge Functions)
- ‚ùå `VITE_OPENROUTER_API_KEY` (—Ç–µ–ø–µ—Ä—å –≤ Supabase Edge Functions)

---

## üìã –ê–ö–¢–ò–í–ù–´–ï EDGE FUNCTIONS

| Function | Status | JWT Verification |
|----------|--------|------------------|
| `stripe-checkout` | ACTIVE | ‚ùå No |
| `stripe-webhook` | ACTIVE | ‚ùå No |
| `openrouter-chat` | ACTIVE | ‚úÖ Yes |

---

## üß™ –ö–ê–ö –ü–†–û–¢–ï–°–¢–ò–†–û–í–ê–¢–¨

### –¢–µ—Å—Ç 1: –ü—Ä–æ–≤–µ—Ä–∫–∞ AI —á–∞—Ç–∞

1. –ó–∞–ø—É—Å—Ç–∏—Ç–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –ª–æ–∫–∞–ª—å–Ω–æ: `npm run dev`
2. –í–æ–π–¥–∏—Ç–µ –≤ —Å–∏—Å—Ç–µ–º—É (—Ç—Ä–µ–±—É–µ—Ç—Å—è –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è!)
3. –û—Ç–∫—Ä–æ–π—Ç–µ AI —á–∞—Ç
4. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –∑–∞–¥–∞—Ç—å –≤–æ–ø—Ä–æ—Å
5. –ï—Å–ª–∏ —Ä–∞–±–æ—Ç–∞–µ—Ç - –≤—Å—ë –æ—Ç–ª–∏—á–Ω–æ! ‚úÖ

### –¢–µ—Å—Ç 2: –ü—Ä–æ–≤–µ—Ä–∫–∞ Stripe

1. –ü–µ—Ä–µ–π–¥–∏—Ç–µ –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—É –ø–æ–¥–ø–∏—Å–æ–∫
2. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ —Å–æ–∑–¥–∞—Ç—å checkout —Å–µ—Å—Å–∏—é
3. Stripe –¥–æ–ª–∂–µ–Ω —Ä–∞–±–æ—Ç–∞—Ç—å –∫–∞–∫ —Ä–∞–Ω—å—à–µ ‚úÖ

---

## üîê –ß–¢–û –ò–ó–ú–ï–ù–ò–õ–û–°–¨ –í –ë–ï–ó–û–ü–ê–°–ù–û–°–¢–ò

### –ë—ã–ª–æ (‚ùå –ù–ï–ë–ï–ó–û–ü–ê–°–ù–û):
```javascript
// Frontend –∫–æ–¥
const API_KEY = import.meta.env.VITE_OPENROUTER_API_KEY;
// ‚ùå –ö–ª—é—á –≤–∏–¥–µ–Ω –≤ –±—Ä–∞—É–∑–µ—Ä–µ DevTools!
```

### –°—Ç–∞–ª–æ (‚úÖ –ë–ï–ó–û–ü–ê–°–ù–û):
```javascript
// Frontend –¥–µ–ª–∞–µ—Ç –∑–∞–ø—Ä–æ—Å –∫ Edge Function
const apiUrl = `${SUPABASE_URL}/functions/v1/openrouter-chat`;
fetch(apiUrl, {
  headers: { 'Authorization': `Bearer ${userToken}` },
  body: JSON.stringify({ messages, model })
});

// Edge Function (Backend) –∏—Å–ø–æ–ª—å–∑—É–µ—Ç —Å–µ–∫—Ä–µ—Ç–Ω—ã–π –∫–ª—é—á
const OPENROUTER_API_KEY = Deno.env.get('OPENROUTER_API_KEY');
```

---

## ‚ö†Ô∏è –í–û–ó–ú–û–ñ–ù–´–ï –ü–†–û–ë–õ–ï–ú–´ –ò –†–ï–®–ï–ù–ò–Ø

### –ü—Ä–æ–±–ª–µ–º–∞ 1: "OPENROUTER_API_KEY is not configured"

**–†–µ—à–µ–Ω–∏–µ:**
- –î–æ–±–∞–≤—å—Ç–µ `OPENROUTER_API_KEY` –≤ Supabase Edge Functions Settings
- –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–µ Edge Function (–æ–Ω–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—Å—è)

### –ü—Ä–æ–±–ª–µ–º–∞ 2: "User is not authenticated"

**–†–µ—à–µ–Ω–∏–µ:**
- AI —á–∞—Ç —Ç–µ–ø–µ—Ä—å —Ç—Ä–µ–±—É–µ—Ç –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏
- –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –∑–∞–ª–æ–≥–∏–Ω–µ–Ω
- –≠—Ç–æ —Å–¥–µ–ª–∞–Ω–æ —Å–ø–µ—Ü–∏–∞–ª—å–Ω–æ –¥–ª—è –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏!

### –ü—Ä–æ–±–ª–µ–º–∞ 3: CORS –æ—à–∏–±–∫–∏

**–†–µ—à–µ–Ω–∏–µ:**
- Edge Function —É–∂–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∞ —Å –ø—Ä–∞–≤–∏–ª—å–Ω—ã–º–∏ CORS –∑–∞–≥–æ–ª–æ–≤–∫–∞–º–∏
- –ï—Å–ª–∏ –ø—Ä–æ–±–ª–µ–º–∞ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è, –ø—Ä–æ–≤–µ—Ä—å—Ç–µ —á—Ç–æ origin –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π

---

## üìä –£–†–û–í–ï–ù–¨ –ë–ï–ó–û–ü–ê–°–ù–û–°–¢–ò

| –î–æ –∏–∑–º–µ–Ω–µ–Ω–∏–π | –ü–æ—Å–ª–µ –∏–∑–º–µ–Ω–µ–Ω–∏–π |
|--------------|-----------------|
| 5/10 ‚ö†Ô∏è | 9/10 ‚úÖ |

**–£–ª—É—á—à–µ–Ω–∏—è:**
- ‚úÖ OpenRouter API –∫–ª—é—á –∑–∞—â–∏—â—ë–Ω
- ‚úÖ STRIPE_SECRET_KEY —É–¥–∞–ª—ë–Ω –∏–∑ frontend
- ‚úÖ Edge Function —Ç—Ä–µ–±—É–µ—Ç –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏
- ‚úÖ –ù–∏–∫–∞–∫–∏—Ö —Å–µ–∫—Ä–µ—Ç–æ–≤ –≤ –±—Ä–∞—É–∑–µ—Ä–µ

---

## üöÄ –î–ï–ü–õ–û–ô –ù–ê NETLIFY

–ü–æ—Å–ª–µ git push –≤ Netlify:

1. ‚úÖ Frontend —Å–æ–±–µ—Ä—ë—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏
2. ‚úÖ –ë—É–¥—É—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω—ã Environment Variables –∏–∑ Netlify
3. ‚úÖ Edge Functions –≤ Supabase —É–∂–µ —Ä–∞–∑–≤—ë—Ä–Ω—É—Ç—ã
4. ‚úÖ –í—Å—ë –¥–æ–ª–∂–Ω–æ —Ä–∞–±–æ—Ç–∞—Ç—å!

**–ï–¥–∏–Ω—Å—Ç–≤–µ–Ω–Ω–æ–µ —á—Ç–æ –Ω—É–∂–Ω–æ:** –¥–æ–±–∞–≤–∏—Ç—å `OPENROUTER_API_KEY` –≤ Supabase Dashboard (—Å–º. –≤—ã—à–µ).

---

## üìû –ü–û–î–î–ï–†–ñ–ö–ê

–ï—Å–ª–∏ —á—Ç–æ-—Ç–æ –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç:

1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ Supabase Edge Functions –ª–æ–≥–∏
2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ Browser DevTools ‚Üí Console
3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —á—Ç–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞–Ω
4. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ Environment Variables –≤ Supabase

---

**–ü–æ—Å–ª–µ–¥–Ω–µ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ:** 2025-11-10
